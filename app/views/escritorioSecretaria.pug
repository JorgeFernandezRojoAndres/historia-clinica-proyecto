extends layout

block content
  h1 Bienvenida, #{user.nombre}

  nav
    ul
      li
        a(href="/secretaria/medicos") Gestionar Médicos
      li
        a(href="/secretaria/pacientes") Gestionar Pacientes
      li
        a#citasBtn(href="/secretaria/citas")
          | Citas
          span#citasEnProceso(class="badge") 0 // Inicialmente muestra 0
      li
        a(href="/logout") Cerrar Sesión

  main
    h2 Acciones Rápidas

    .acciones-rapidas
      a(href="/secretaria/medicos/new") Agregar Nuevo Médico
      a(href="/secretaria/pacientes/new") Agregar Nuevo Paciente
      a(href="/secretaria/citas/new") Agregar Nueva Cita

    h2 Notificaciones
    #notificaciones(style="border: 1px solid #ccc; padding: 10px; min-height: 50px;")
      p No hay notificaciones recientes

    h2 Listado de Pacientes

    //- Formulario de búsqueda
    form(method="GET", action="/secretaria/pacientes")
      input(type="text", name="apellido", placeholder="Buscar paciente por apellido")
      button(type="submit") Buscar

    //- Tabla de pacientes
    table
      thead
        tr
          th ID
          th Nombre
          th Fecha de Nacimiento
          th DNI
          th Dirección
          th Teléfono
          th Acciones
      tbody
        each paciente in pacientes
          tr
            td= paciente.id
            td= paciente.nombre
            td= paciente.fechaNacimiento
            td= paciente.dni
            td= paciente.direccion
            td= paciente.telefono
            td
              a(href=`/secretaria/pacientes/${paciente.id}/edit`) Editar
              form(method="POST" action=`/secretaria/pacientes/${paciente.id}/delete` onsubmit="return confirm('¿Estás seguro de eliminar este paciente?');")
                button(type="submit") Eliminar

  // Scripts para actualizar el contador de citas en proceso
  script.
    document.addEventListener('DOMContentLoaded', function() {
  // Obtener el span del contador de citas en proceso
  const citasEnProcesoBadge = document.getElementById('citasEnProceso');

  // Verificar si existe el elemento antes de realizar el fetch
  if (citasEnProcesoBadge) {
    // Obtener la cantidad de citas en proceso
    fetch('/citas/count-en-proceso')
      .then(response => response.json())
        .then(data => {
          if (data.count > 0) {
            citasEnProcesoBadge.textContent = data.count;
            citasEnProcesoBadge.style.display = 'inline';
            } else {
              citasEnProcesoBadge.style.display = 'none';
              }
              })
              .catch(error => console.error('Error al obtener citas en proceso:', error));
              }
              });

