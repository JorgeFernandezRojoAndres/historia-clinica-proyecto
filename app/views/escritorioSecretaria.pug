extends layout

block content
  h1 Bienvenida, #{user.nombre}

  nav
    ul
      li
        a(href="/secretaria/pacientes") Gestionar Pacientes
      li
        a#citasBtn(href="/secretaria/citas")
          | Citas
          span#citasEnProceso(class="badge") 0
      li
        a(href="/logout") Cerrar Sesión

  main
    h2 Acciones Rápidas

    .acciones-rapidas
      a(href="/secretaria/pacientes/new") Agregar Nuevo Paciente
      a(href="/secretaria/citas/new") Agregar Nueva Cita
      button#selectClinicBtn(type="button") Seleccionar Clínica

    h2 Notificaciones
    #notificaciones(style="border: 1px solid #ccc; padding: 10px; min-height: 50px;")
      p No hay notificaciones recientes

    h2 Listado de Pacientes

    form(method="GET", action="/secretaria/pacientes")
      input(type="text", name="apellido", placeholder="Buscar paciente por apellido")
      button(type="submit") Buscar

    table
      thead
        tr
          th ID
          th Nombre
          th Fecha de Nacimiento
          th DNI
          th Dirección
          th Teléfono
          th Acciones
      tbody
        each paciente in pacientes
          tr
            td= paciente.id
            td= paciente.nombre
            td= paciente.fechaNacimiento
            td= paciente.dni
            td= paciente.direccion
            td= paciente.telefono
            td
              a(href=`/secretaria/pacientes/${paciente.id}/edit`) Editar
              form(method="POST", action=`/secretaria/pacientes/${paciente.id}/delete` onsubmit="return confirm('¿Estás seguro de eliminar este paciente?');")
                button(type="submit") Eliminar

    h3 Seleccionar Fecha y Hora
    form(method="POST", action="/secretaria/citas")
      label(for="fechaHora") Fecha y Hora de la Cita:
      input(type="datetime-local", id="fechaHora", name="fechaHora")
      button(type="submit") Crear Cita

  // Ventana modal para seleccionar clínica
  #clinicModal(style="display:none;")
    .modal-content
      h2 Seleccionar Clínica
      form(action="/seleccionar-clinica" method="POST")
        input(type="hidden" name="idClinica" value="1") 
        button(type="submit") Clínica Integral SaludPlus
        input(type="hidden" name="idClinica" value="2") 
        button(type="submit") Clínica Médico Vida Total
        button(type="button" onclick="closeModal()") Cerrar

  script.
    function closeModal() {
      document.getElementById('clinicModal').style.display = 'none';  // Ocultar el modal
    }

    document.getElementById('selectClinicBtn').onclick = function() {
      document.getElementById('clinicModal').style.display = 'block';  // Mostrar el modal
    };

    // Añadimos el console.log para depurar la selección de horarios
    function seleccionarHorario(fecha, hora) {
      const fechaHora = `${fecha}T${hora}:00`;
      console.log("Fecha y hora seleccionada:", fechaHora);  // Depuración: Verifica la fecha y hora seleccionada

      
      if (window.opener && !window.opener.closed) {
        const fechaHoraInput = window.opener.document.getElementById('fechaHora');
        if (fechaHoraInput) {
          fechaHoraInput.value = fechaHora;  // Establece el valor de fecha y hora en el campo de la ventana principal
        } else {
          alert("No se encontró el campo de fecha y hora en la ventana principal.");
        }
      } else {
        alert("La ventana principal no está disponible.");
      }

      // Cerrar la ventana emergente
      window.close();
    }

script(src="/selectorMedico.js")
