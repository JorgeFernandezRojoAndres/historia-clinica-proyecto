{
  "app": {
    "views": {
      "escritorioMedico.pug": "extends layout\r\n\r\nblock content\r\n  h1 Bienvenido, Dr/Dra #{user.nombre}\r\n\r\n  nav\r\n    ul\r\n      li\r\n        a(onclick=`window.open('/medicos/${user.id}/agenda', 'AgendaMedico', 'width=800,height=600,resizable=yes,scrollbars=yes'); return false;`) Ver Agenda\r\n      li\r\n        a(href=\"/historias\") Historial Clínico\r\n      li\r\n        a(href=\"/logout\") Cerrar Sesión\r\n  main\r\n    section.accesos-rapidos\r\n      h2 Accesos Rápidos\r\n      div.botones-rapidos\r\n        //- Verificar si hay citas para mostrar \"Iniciar Consulta\"\r\n        if citas && citas.length > 0\r\n          button.btn-rapido(onclick=`window.open('/medicos/iniciar-consulta/${citas[0].idCita}', 'Iniciar Consulta', 'width=800,height=600,resizable=yes,scrollbars=yes')`)\r\n            img(src=\"/images/btnIniCon.png\" alt=\"Iniciar Consulta - #{citas[0].nombrePaciente}\")\r\n        else\r\n          //- Botón de sobreturno cuando no hay citas regulares\r\n          button.btn-rapido(onclick=`window.open('/medicos/atender-sobreturno', 'Atender Sobreturno', 'width=800,height=600,resizable=yes,scrollbars=yes')`)\r\n            img(src=\"/images/btnAtenderSobreturno.png\" alt=\"Atender Sobreturno\")\r\n\r\n          //- Campo de búsqueda de paciente para sobreturno\r\n          label(for=\"buscarPacienteSobreturno\") Buscar Paciente:\r\n          input(type=\"text\" id=\"buscarPacienteSobreturno\" placeholder=\"Ingresa nombre del paciente\" autocomplete=\"off\")\r\n          ul#listaResultadosSobreturno\r\n\r\n          //- Botón para cargar el historial del paciente seleccionado\r\n          button.btn-rapido(onclick=\"cargarHistorialSobreturno()\")\r\n            img(src=\"/images/btnAtenderSobreturno.png\" alt=\"Atender Sobreturno\")\r\n\r\n        // Script para manejar el autocompletado de búsqueda de paciente\r\n        script.\r\n          document.addEventListener('DOMContentLoaded', function() {\r\n            const inputBuscarPaciente = document.getElementById('buscarPacienteSobreturno');\r\n            const listaResultados = document.getElementById('listaResultadosSobreturno');\r\n\r\n            inputBuscarPaciente.addEventListener('input', function() {\r\n              const query = this.value;\r\n              if (query.length >= 2) {\r\n                fetch(`/pacientes/buscar?query=${query}`)\r\n                  .then(response => response.json())\r\n                  .then(pacientes => {\r\n                    listaResultados.innerHTML = '';\r\n                    pacientes.forEach(paciente => {\r\n                      const li = document.createElement('li');\r\n                      li.textContent = `${paciente.nombre} - DNI: ${paciente.dni}`;\r\n                      li.onclick = () => seleccionarPacienteSobreturno(paciente);\r\n                      listaResultados.appendChild(li);\r\n                    });\r\n                  })\r\n                  .catch(error => console.error('Error al buscar pacientes:', error));\r\n              } else {\r\n                listaResultados.innerHTML = '';\r\n              }\r\n            });\r\n          });\r\n\r\n          function seleccionarPacienteSobreturno(paciente) {\r\n            document.getElementById('buscarPacienteSobreturno').value = paciente.nombre;\r\n            window.open(`/medicos/historial/${paciente.idPaciente}`, 'HistorialPaciente', 'width=800,height=600,resizable=yes,scrollbars=yes');\r\n          }\r\n      //- Verificar si hay pacientes antes de mostrar el botón de historial\r\n      if pacientes && pacientes.length > 0\r\n          button.btn-rapido(onclick=`window.open('/medicos/historial', 'BuscarHistorial', 'width=800,height=600,resizable=yes,scrollbars=yes')`)\r\n            img(src=\"/images/btnHDA.png\" alt=\"Historial de Atenciones\")\r\n      else\r\n        p No hay pacientes disponibles.\r\n\r\n      //- Botones adicionales para el médico\r\n      button.btn-rapido(onclick=`window.open('/medicos/registrar-evolucion', 'Registrar Evolucion', 'width=800,height=600,resizable=yes,scrollbars=yes')`)\r\n        img(src=\"/images/btnREvo.png\" alt=\"Registrar Evolución\")\r\n\r\n      button.btn-rapido(onclick=`window.open('/medicos/agregar-diagnostico', 'Agregar Diagnostico', 'width=800,height=600,resizable=yes,scrollbars=yes')`)\r\n        img(src=\"/images/btnAgDiag.png\" alt=\"Agregar Diagnóstico\")\r\n\r\n      button.btn-rapido(onclick=`window.open('/medicos/agregar-alergias', 'Agregar Alergias', 'width=800,height=600,resizable=yes,scrollbars=yes')`)\r\n        img(src=\"/images/btnAGALE.png\" alt=\"Agregar Alergias\")\r\n\r\n      button.btn-rapido(onclick=`window.open('/medicos/registrar-antecedentes', 'Registrar Antecedentes', 'width=800,height=600,resizable=yes,scrollbars=yes')`)\r\n        img(src=\"/images/btnREGant.png\" alt=\"Registrar Antecedentes\")\r\n\r\n      button.btn-rapido(onclick=`window.open('/medicos/registrar-habitos', 'Registrar Habitos', 'width=800,height=600,resizable=yes,scrollbars=yes')`)\r\n        img(src=\"/images/btnREHABB.png\" alt=\"Registrar Hábitos\")\r\n\r\n      button.btn-rapido(onclick=`window.open('/medicos/medicamentos', 'Registrar Medicamentos', 'width=800,height=600,resizable=yes,scrollbars=yes')`)\r\n        img(src=\"/images/btnMEENus.png\" alt=\"Registrar Medicamentos en Uso\")\r\n\r\n      button.btn-rapido(onclick=`window.open('/medicos/template-nota', 'Template Nota', 'width=800,height=600,resizable=yes,scrollbars=yes')`)\r\n        img(src=\"/images/templatebtn.png\" alt=\"Usar Template de Nota Clínica\")\r\n"
    }
  }
}